<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>D3 Map Example</title>

    <style type="text/css">

.tooltip{
  position: absolute;
  border:1px solid #cccccc;
  background-color:rgba(255,255,255,0.9);
  opacity:0;
  max-width: 290px;
  min-width: 130px;
  transform:translate(-50%, -100%);
  pointer-events: none;
  padding: 10px 10px;
  font-size: 10pt;
  font-family: Roboto;
  fill: #000;
}

.svg-container {
    position: relative;
    width: 80%;
    padding-bottom: 50%;
    /* vertical-align: top; */
    /* overflow: hidden; */
}


.svg-content {
    position: absolute;
}


.counties {
  fill: none;
  stroke: #fff;
  stroke-linejoin: round;
}


</style>
</head>
<body>


  <div id="container" class="svg-container">
  </div>

  <table class="table table-bordered table-hover table-condensed">
<thead><tr><th title="Field #1">Facility</th>
<th title="Field #2">Number of positive residents</th>
<th title="Field #3">Number of health care works</th>
<th title="Field #4">Total</th>
</tr></thead>
<tbody><tr>
<td>Briarwood Nursing Center</td>
<td align="right">43</td>
<td align="right">17</td>
<td align="right">60</td>
</tr>
<tr>
<td>Villages of General Baptist West</td>
<td align="right">2</td>
<td align="right">2</td>
<td align="right">4</td>
</tr>
<tr>
<td>The Lakes of Maumelle Health and Rehab</td>
<td align="right">36</td>
<td align="right">11</td>
<td align="right">47</td>
</tr>
<tr>
<td>Apple Creek Health and Rehabilitation</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">1</td>
</tr>
<tr>
<td>Springhouse Village</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">1</td>
</tr>
<tr>
<td>Waters of White Hall</td>
<td align="right">40</td>
<td align="right">30</td>
<td align="right">70</td>
</tr>
<tr>
<td>Greene Acres Nursing Home</td>
<td align="right">2</td>
<td align="right">0</td>
<td align="right">2</td>
</tr>
<tr>
<td>Newton County Nursing Home</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">2</td>
</tr>
<tr>
<td>Walnut Ridge Nursing &amp; Rehab</td>
<td align="right">54</td>
<td align="right">25</td>
<td align="right">79</td>
</tr>
<tr>
<td>Willow Bend Healthcare &amp; Rehab</td>
<td align="right">30</td>
<td align="right">17</td>
<td align="right">47</td>
</tr>
<tr>
<td>Ozark Health Nursing and Rehab Center</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
<tr>
<td>Legacy Heights Nursing &amp; Rehab</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">2</td>
</tr>
<tr>
<td>Conway Healthcare &amp; Rehab</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
<tr>
<td>Salem Place N&amp;R</td>
<td align="right">1</td>
<td align="right">5</td>
<td align="right">6</td>
</tr>
<tr>
<td>Community Compassion Center of Jonesboro</td>
<td align="right">0</td>
<td align="right">5</td>
<td align="right">5</td>
</tr>
<tr>
<td>Community Compassion Center of Batesville</td>
<td align="right">2</td>
<td align="right">1</td>
<td align="right">3</td>
</tr>
<tr>
<td>Allay Health and Rehab</td>
<td align="right">5</td>
<td align="right">5</td>
<td align="right">10</td>
</tr>
<tr>
<td>The Greenhouse Cottages of Belle Meade</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">2</td>
</tr>
<tr>
<td>Meadowview Healthcare &amp; Rehab</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">1</td>
</tr>
<tr>
<td>Parkway Heights Village</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">2</td>
</tr>
<tr>
<td>Encore Healthcare &amp; Rehab-WLR</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">2</td>
</tr>
<tr>
<td>West Memphis H&amp;R</td>
<td align="right">5</td>
<td align="right">4</td>
<td align="right">9</td>
</tr>
<tr>
<td>Encompass Rehab/LTC</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">2</td>
</tr>
<tr>
<td>Indian Rock Village</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
<tr>
<td>Mine Creek Health &amp; Rehab</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">2</td>
</tr>
<tr>
<td>Rector Nursing and Rehab</td>
<td align="right">2</td>
<td align="right">0</td>
<td align="right">2</td>
</tr>
<tr>
<td>Randolph Co Nursing Home</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">1</td>
</tr>
<tr>
<td>Crestpark Of Wynne</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">2</td>
</tr>
<tr>
<td>The Village at Valley Ranch</td>
<td align="right">3</td>
<td align="right">4</td>
<td align="right">7</td>
</tr>
<tr>
<td>Rogers Health &amp; Rehab</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">1</td>
</tr>
<tr>
<td>Harris Healthcare</td>
<td align="right">17</td>
<td align="right">5</td>
<td align="right">22</td>
</tr>
<tr>
<td>Greenhouse Cottages of Poplar Grove</td>
<td align="right">2</td>
<td align="right">4</td>
<td align="right">6</td>
</tr>
<tr>
<td>Summit Health &amp; Rehab</td>
<td align="right">7</td>
<td align="right">4</td>
<td align="right">11</td>
</tr>
<tr>
<td>Southfork River Therapy &amp; Living</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">1</td>
</tr>
<tr>
<td>Belle View Estates</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">1</td>
</tr>
<tr>
<td>Brookstone Assisted Living Community</td>
<td align="right">3</td>
<td align="right">1</td>
<td align="right">4</td>
</tr>
<tr>
<td>Ash Flat Healthcare &amp; Rehab</td>
<td align="right">28</td>
<td align="right">9</td>
<td align="right">37</td>
</tr>
<tr>
<td>Gardner Nursing and Rehabilitation</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
<tr>
<td>Crestpark of Forrest City</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">2</td>
</tr>
<tr>
<td>Mcgehee Health And Rehabilitation Center</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
<tr>
<td>Spring Creek Health &amp; Rehab</td>
<td align="right">2</td>
<td align="right">0</td>
<td align="right">2</td>
</tr>
<tr>
<td>CCC-W. Memphis/Broadway Health &amp; Rehab</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
<tr>
<td>Twin Rivers Health &amp; Rehab</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">1</td>
</tr>
<tr>
<td>The Pines Nursing &amp; Rehab Center</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">1</td>
</tr>
<tr>
<td>Robinson Health &amp; Rehab</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
<tr>
<td>Courtyard Healthcare &amp; Rehab</td>
<td align="right">15</td>
<td align="right">7</td>
<td align="right">22</td>
</tr>
<tr>
<td>Amberwood Health &amp; Rehab</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
<tr>
<td>West Memphis Residential Inc.</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
<tr>
<td>Craighead Nursing Center</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
<tr>
<td>Hospice Home Care Center</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
<tr>
<td>Silver Oaks Health &amp; Rehab</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">1</td>
</tr>
</tbody></table>

<script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
<script src="https://d3js.org/d3.v5.min.js"></script>
<script src="https://d3js.org/d3-geo-projection.v2.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/topojson/3.0.2/topojson.min.js"></script>
<script>

var svgContainer = d3.select('div#container');

var svg4 = svgContainer.append('svg')
.attr("preserveAspectRatio", "xMinYMin meet")
.attr("viewBox", "-10 10 1000 1000")
.classed("svg-content", true);
//     .on('mousemove', function() {
// console.log( d3.event.pageY )
// });


var div = d3.select("div#container")
.append("div")
.attr("class", "tooltip")
.style("opacity", 0);

    Promise.all([
      d3.json("https://raw.githubusercontent.com/adgnewsroom/virus-tracker/master/arkansas.json"),
      d3.csv("nursinghome.csv")
])
.then(function(data){

    var data_map = d3.map();


        data[1].forEach(function(d){
          d["Lat"] = +d["Lat"];
          d["Long"] = +d["Long"];
          d["total"] = +d["total"];
        });

          var projection = d3.geoAlbersUsa()
          .fitSize([500, 500], topojson.feature(data[0], data[0].objects.test));

           //this is a function, where if you give it projectLatLong([Long, latitutde])
           var projectLatLong = d3.geoAlbersUsa()
                .fitSize([500, 500], topojson.feature(data[0], data[0].objects.test));


    var path = d3.geoPath()
        .projection(projection);


      var confirmedScale = d3.scaleSqrt()
        .domain(d3.extent(data[1], function(d){ return d["total"]}))
        .range([3, 15]);

      data[1].sort(function(a,b){ b.total - a.total});


            svg4.selectAll("path")
                .data(topojson.feature(data[0], data[0].objects.test).features)
                .enter()
                .append("path")
                .attr("d", path)
                .attr("stroke", "#fff")
                .attr("fill", "#ddd");

                // add circles to svg
              svg4.selectAll(".bubbles")
                .data(data[1])
                .enter()
                .append("circle")
                .attr("class", "bubbles")
                .attr("cx", function (d) {
                  if(projectLatLong([d["Long"], d["Lat"]]) != null){
                    return projectLatLong([d["Long"], d["Lat"]])[0];
                  }
                })
                .attr("cy", function (d) {
                  if(projectLatLong([d["Long"], d["Lat"]]) != null){
                    return projectLatLong([d["Long"], d["Lat"]])[1];
                  }
                })
                .attr("r", function(d){ return confirmedScale(d["total"]); })
                .attr("fill", "#F4A460")
                .attr("opacity", 0.9)
                .attr("stroke", "white")
                .attr("stroke-width", 0.5)
                .on("mouseover", function(d) {
                      d3.select(".tooltip")
                        .style("opacity", 1)
                        .style("left", (d3.event.x-70) + "px")
                        .style("top", (d3.event.y+20) + "px")
                        .style("font-size", "11px")
                        .style("font-family", "'Roboto', sans-serif")
                        .html("<strong style='color:firebrick; font-size:11pt;'>" + d["Facility"] + "</strong>" + "<br>" + "Positive Residents: " + d["Resident"] + "<br>" + "Positive Health care workers: " + d["HCW"]);
                })
                .on("mouseout", function(d) {
                      d3.select(".tooltip")
                        .style("opacity",0);
                })
        });



        </script>
